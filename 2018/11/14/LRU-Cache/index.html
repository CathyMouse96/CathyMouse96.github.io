<!DOCTYPE html>
<html lang="">

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.ico">
    

    <title>
        
          LRU Cache - CMouse&#39;s Blog
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">
    <!-- Noto Sans SC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC" rel="stylesheet">
    <!-- Noto Sans -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

    <!-- theme css & js -->
    <link rel="stylesheet" href="/css/book.css">
    <script src="/js/book.js"></script>

    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('img')
})
</script>

</head>

<body>

<div class="container">
  <div class="book-container">
    <div class="columns">
      <div class="column col-2 hide-lg">
        <div class="book-sidebar">
  <h4 class="site-meta">
    <a href="/">CMouse&#39;s Blog</a>
  </h4>
  <div class="sidebar-content">
    <ul>
<li><a href="/">Home</a></li>
<li><a href="/2019/12/02/picoctf/README">picoCTF 2019</a><ul>
<li><a href="/2019/11/19/picoctf/whitepages">WhitePages</a></li>
<li><a href="/2019/12/02/picoctf/c0rrupt">c0rrupt</a></li>
<li><a href="/2019/12/02/picoctf/asm3">asm3</a></li>
<li><a href="/2019/12/02/picoctf/asm4">asm4</a></li>
</ul>
</li>
<li>CyberForce 2019<ul>
<li><a href="/2019/12/02/cyberforce/CyberForce-2019-Recap-Cathy">Cathy’s Recap</a></li>
</ul>
</li>
<li><a href="/2019/12/02/Weird-CS-Doodles">Weird CS Doodles</a></li>
</ul>

  </div>
</div>

<script src="/js/book-sidebar.js"></script>

<script>
collapse_sidebar(2)
highlight_tab()
show_sidebar()
</script>
      </div>

      <div class="column col-8 col-lg-12">
        <div class="book-content">
          <div class="book-navbar">
  <header class="navbar">
  <section class="navbar-section">
    <img class="navbar-icon" src="/favicon.ico">
  </section>
  <section class="navbar-center">
    CMouse&#39;s Blog
  </section>
  <section class="navbar-section">
    <label class="accordion-header c-hand" for="accordion-sidebar">
      <i class="icon icon-menu"></i>
    </label>
  </section>
</header>

<div class="accordion">
  <input type="checkbox" id="accordion-sidebar" name="accordion-checkbox" hidden>
  <div class="accordion-body">
    <ul>
<li><a href="/">Home</a></li>
<li><a href="/2019/12/02/picoctf/README">picoCTF 2019</a><ul>
<li><a href="/2019/11/19/picoctf/whitepages">WhitePages</a></li>
<li><a href="/2019/12/02/picoctf/c0rrupt">c0rrupt</a></li>
<li><a href="/2019/12/02/picoctf/asm3">asm3</a></li>
<li><a href="/2019/12/02/picoctf/asm4">asm4</a></li>
</ul>
</li>
<li>CyberForce 2019<ul>
<li><a href="/2019/12/02/cyberforce/CyberForce-2019-Recap-Cathy">Cathy’s Recap</a></li>
</ul>
</li>
<li><a href="/2019/12/02/Weird-CS-Doodles">Weird CS Doodles</a></li>
</ul>

  </div>
</div>
</div>

<div class="book-post">
  <p>This is my solution to <a href="https://leetcode.com/problems/lru-cache/" target="_blank" rel="noopener">LeetCode’s LRU Cache problem</a>. It is written in Python 3. In this problem, we are asked to implement an LRU cache that supports <code>get(key)</code> and <code>put(key, value)</code> in O(1) time.</p>
<h2 id="Intuition"><a href="#Intuition" class="headerlink" title="Intuition"></a>Intuition</h2><p>We can easily achieve O(1) time for <code>get(key)</code> if we use a hash table for the cache. However, we need to maintain the LRU status, or in other words, the order in which cache entries were accessed. If we use an array, time complexity for the operations will become O(n). So we think about using a linked list.</p>
<a id="more"></a>
<p>For each key in the cache, along with its value, we store a <code>prev</code> pointer and a <code>next</code> pointer. The <code>prev</code> pointer points to the entry that was accessed immediately before this entry was accessed. The <code>next</code> pointer points to the entry that was accessed immediately after this entry was accessed. We also maintain two variables <code>lru</code> and <code>mru</code>: the key that was accessed least recently and the key that was accessed most recently, respectively. The cache looks like this:</p>
<h3 id="get-key-operation"><a href="#get-key-operation" class="headerlink" title="get(key) operation"></a>get(key) operation</h3><p>If <code>key</code> does not exist in our cache, we return -1.<br>If <code>key</code> already is the most recently accessed key (<code>mru == key</code> and <code>cache[key].next == None</code>), we do not need to make any changes to the LRU status. We simply return its value.<br>Otherwise, if <code>key</code> originally was the least recently accessed key (<code>lru == key</code> and <code>cache[key].prev == None</code>), <code>cache[key].next</code> now becomes the least recently accessed key, and <code>key</code> now becomes the most recently accessed key.<br>Otherwise, we remove <code>key</code> from its original spot and make it the most recently accessed key.<br>The code is as follows:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :type key: int</span></span><br><span class="line"><span class="string">    :rtype: int</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.cache:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="comment"># Update LRU status</span></span><br><span class="line">    value, lruprev, lrunext = self.cache[key]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> lrunext: <span class="comment"># Already most recently used</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> lruprev: <span class="comment"># Originally least recently used</span></span><br><span class="line">        <span class="comment"># next becomes lru</span></span><br><span class="line">        self.cache[lrunext][<span class="number">1</span>] = <span class="keyword">None</span></span><br><span class="line">        self.lru = lrunext</span><br><span class="line">        <span class="comment"># key becomes mru</span></span><br><span class="line">        self.cache[self.mru][<span class="number">2</span>] = key</span><br><span class="line">        self.cache[key][<span class="number">1</span>] = self.mru</span><br><span class="line">        self.cache[key][<span class="number">2</span>] = <span class="keyword">None</span></span><br><span class="line">        self.mru = key</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.cache[lruprev][<span class="number">2</span>] = lrunext</span><br><span class="line">        self.cache[lrunext][<span class="number">1</span>] = lruprev</span><br><span class="line">        <span class="comment"># key becomes mru</span></span><br><span class="line">        self.cache[self.mru][<span class="number">2</span>] = key</span><br><span class="line">        self.cache[key][<span class="number">1</span>] = self.mru</span><br><span class="line">        self.cache[key][<span class="number">2</span>] = <span class="keyword">None</span></span><br><span class="line">        self.mru = key</span><br><span class="line">    <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure></p>

</div>


  <div class="book-comments">
    




  </div>


<script src="/js/book-post.js"></script>
        </div>
      </div>

      <div class="column col-2 hide-lg">
        <div class="book-toc">
  <div class="book-tocbot">
  </div>
  <div class="book-tocbot-menu">
    <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
    <a onclick="go_top()">Back to top</a>
    <a onclick="go_bottom()">Go to bottom</a>
  </div>
</div>

<script>
tocbot.init({
  tocSelector: '.book-tocbot',
  contentSelector: '.book-post',
  headingSelector: 'h1, h2, h3, h4, h5',
  collapseDepth: 2,
  orderedList: false,
  scrollSmooth: false,
});

function expand_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 6,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "collapse_toc()");
  b.innerHTML = "Collapse all"
}

function collapse_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 2,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "expand_toc()");
  b.innerHTML = "Expand all"
}

function go_top() {
  window.scrollTo(0, 0);
}

function go_bottom() {
  window.scrollTo(0, document.body.scrollHeight);
}

</script>
      </div>
    </div>
  </div>
</div>

</body>
</html>
