<!DOCTYPE html>
<html lang="">

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.ico">
    

    <title>
        
          c0rrupt - CMouse&#39;s Blog
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">
    <!-- Noto Sans SC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC" rel="stylesheet">
    <!-- Noto Sans -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

    <!-- theme css & js -->
    <link rel="stylesheet" href="/css/book.css">
    <script src="/js/book.js"></script>

    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('img')
})
</script>

</head>

<body>

<div class="container">
  <div class="book-container">
    <div class="columns">
      <div class="column col-2 hide-lg">
        <div class="book-sidebar">
  <h4 class="site-meta">
    <a href="/">CMouse&#39;s Blog</a>
  </h4>
  <div class="sidebar-content">
    <ul>
<li><a href="/">Home</a></li>
<li><a href="/picoctf/picoctf-2019">picoCTF 2019</a><ul>
<li><a href="/picoctf/whitepages">WhitePages</a></li>
<li><a href="/picoctf/c0rrupt">c0rrupt</a></li>
<li><a href="/picoctf/webnet0">WebNet0</a></li>
<li><a href="/picoctf/webnet1">WebNet1</a></li>
<li><a href="/picoctf/asm3">asm3</a></li>
<li><a href="/picoctf/asm4">asm4</a></li>
</ul>
</li>
<li><a href="/cyberforce/cyberforce-2019">CyberForce 2019</a><ul>
<li><a href="/cyberforce/cyberforce-2019-recap-cathy">Cathy’s Recap</a></li>
<li><a href="/cyberforce/anomaly-23">Anomaly 23</a></li>
</ul>
</li>
<li><a href="/uncategorized/weird-cs-doodles">Weird CS Doodles</a></li>
</ul>

  </div>
</div>

<script src="/js/book-sidebar.js"></script>

<script>
collapse_sidebar(2)
highlight_tab()
show_sidebar()
</script>
      </div>

      <div class="column col-8 col-lg-12">
        <div class="book-content">
          <div class="book-navbar">
  <header class="navbar">
  <section class="navbar-section">
    <img class="navbar-icon" src="/favicon.ico">
  </section>
  <section class="navbar-center">
    CMouse&#39;s Blog
  </section>
  <section class="navbar-section">
    <label class="accordion-header c-hand" for="accordion-sidebar">
      <i class="icon icon-menu"></i>
    </label>
  </section>
</header>

<div class="accordion">
  <input type="checkbox" id="accordion-sidebar" name="accordion-checkbox" hidden>
  <div class="accordion-body">
    <ul>
<li><a href="/">Home</a></li>
<li><a href="/picoctf/picoctf-2019">picoCTF 2019</a><ul>
<li><a href="/picoctf/whitepages">WhitePages</a></li>
<li><a href="/picoctf/c0rrupt">c0rrupt</a></li>
<li><a href="/picoctf/webnet0">WebNet0</a></li>
<li><a href="/picoctf/webnet1">WebNet1</a></li>
<li><a href="/picoctf/asm3">asm3</a></li>
<li><a href="/picoctf/asm4">asm4</a></li>
</ul>
</li>
<li><a href="/cyberforce/cyberforce-2019">CyberForce 2019</a><ul>
<li><a href="/cyberforce/cyberforce-2019-recap-cathy">Cathy’s Recap</a></li>
<li><a href="/cyberforce/anomaly-23">Anomaly 23</a></li>
</ul>
</li>
<li><a href="/uncategorized/weird-cs-doodles">Weird CS Doodles</a></li>
</ul>

  </div>
</div>
</div>

<div class="book-post">
  <h1 id="c0rrupt"><a href="#c0rrupt" class="headerlink" title="c0rrupt"></a>c0rrupt</h1><p>Category: Forensics<br>Points: 250 pts</p>
<p>We found this <a href="https://2019shell1.picoctf.com/static/3435d990f1d20fe3563cbb897b4c96db/mystery" target="_blank" rel="noopener">file</a>. Recover the flag. You can also find the file in /problems/c0rrupt_0_1fcad1344c25a122a00721e4af86de13.</p>
<hr>
<p>Running <code>binwalk</code> on <code>mystery</code> gives us:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">91            0x5B            Zlib compressed data, compressed</span><br></pre></td></tr></table></figure>
<p>There is Zlib compressed data at offset 91, which gives us suspicion that the file might be a PNG. Opening the file in a hex editor shows the trailer bytes <code>49 45 4E 44 AE 42 60 82</code>, which confirms our suspicion.</p>
<p><img src="/images/picoctf/corrupt1.jpeg" alt="corrupt1"></p>
<p>So lets try to fix the file header according to the PNG format.</p>
<p>The first 8 bytes should be <code>89 50 4E 47 0D 0A 1A 0A</code>.</p>
<p><img src="/images/picoctf/corrupt2.jpeg" alt="corrupt2"></p>
<p>The next 25 bytes is the IHDR chunk. The length part should be <code>00 00 00 0d</code>. The chunk type should be <code>49 48 44 52</code>. Since we don’t know about the data, we’ll keep the next 13 bytes as they are. Finally, we compute the checksum, which should be <code>7c 8b ab 78</code> (Note: if you’re using <code>cksum</code>, remember to use <code>cksum -o 3</code> instead of the default algorithm when no options are supplied). Turns out only the chunk type is corrupted in this file.</p>
<p><img src="/images/picoctf/corrupt3.jpeg" alt="corrupt3"></p>
<p>Next are the sRGB, gAMA and pHYs chunks. We won’t go into the details of these. In fact, the fastest way to fix them is to take another challenge’s <code>flag.png</code> as reference and modify the bytes accordingly. We found that the only byte that differs is at 0x46, which we change to 0x00.</p>
<p><img src="/images/picoctf/corrupt4.jpeg" alt="corrupt4"></p>
<p>Finally, there is the IDAT chunk, which holds the actual image, compressed with zlib. We know that the data part of the chunk starts at 0x5B and ends at 0x318AB. So the length should be <code>00 03 18 51</code>. The type is <code>49 44 41 54</code>.</p>
<p><img src="/images/picoctf/corrupt5.jpeg" alt="corrupt5"></p>
<p>We’ve fixed our file!</p>
<p><img src="/images/picoctf/corrupt6.jpeg" alt="corrupt6"></p>
<p><strong>References:</strong></p>
<p><a href="https://www.garykessler.net/library/file\_sigs.html" target="_blank" rel="noopener">https://www.garykessler.net/library/file\_sigs.html</a></p>
<p><a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Structure.html" target="_blank" rel="noopener">http://www.libpng.org/pub/png/spec/1.2/PNG-Structure.html</a></p>
<p><a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html" target="_blank" rel="noopener">http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html</a></p>
<p><a href="https://stackoverflow.com/questions/54845745/not-able-to-read-ihdr-chunk-of-a-png-file" target="_blank" rel="noopener">https://stackoverflow.com/questions/54845745/not-able-to-read-ihdr-chunk-of-a-png-file</a></p>

</div>


  <div class="book-comments">
    




  </div>


<script src="/js/book-post.js"></script>
        </div>
      </div>

      <div class="column col-2 hide-lg">
        <div class="book-toc">
  <div class="book-tocbot">
  </div>
  <div class="book-tocbot-menu">
    <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
    <a onclick="go_top()">Back to top</a>
    <a onclick="go_bottom()">Go to bottom</a>
  </div>
</div>

<script>
tocbot.init({
  tocSelector: '.book-tocbot',
  contentSelector: '.book-post',
  headingSelector: 'h1, h2, h3, h4, h5',
  collapseDepth: 2,
  orderedList: false,
  scrollSmooth: false,
});

function expand_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 6,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "collapse_toc()");
  b.innerHTML = "Collapse all"
}

function collapse_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 2,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "expand_toc()");
  b.innerHTML = "Expand all"
}

function go_top() {
  window.scrollTo(0, 0);
}

function go_bottom() {
  window.scrollTo(0, document.body.scrollHeight);
}

</script>
      </div>
    </div>
  </div>
</div>

</body>
</html>
